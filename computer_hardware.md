# コンピュータ構成要素とハードウェア
### CPUの動作
- コンピュータのハードウェアは、「制御装置」「演算装置」「記憶装置」「入力装置」「出力装置」の大きく５つに分けられる。
- CPU(プロセッサ)はコンピュータの頭脳に相当するもので、機器のコントロールや演算処理を行う。上記の「制御装置」「演算装置」で構成される。
- 「記憶装置」は主記憶装置であるメインメモリと、補助記憶装置であるハードディスクなどから構成される。
- 「入力装置」はデータを入力する装置のこと。キーボードやマウスなど。
- 「出力装置」はデータを出力する装置のこと。ディスプレイやプリンターなど。
<br />
<br />

CPUはメモリから命令やデータを取り出し、実行、結果をまたメモリに格納する、ということを繰り返す。<br>
動作をまとめると下記のようになる。（命令サイクル、と呼ぶ）<br>
<br />

- 命令フェッチ：メモリから命令を取得する。
- デコード：取得した命令を解読し、CPU内部のどの回路を動作させるか決める。
- オペランドフェッチ：メモリから処理対象のデータを取得する。
- 実行：オペランドフェッチで取得したデータを命令フェッチで取得した命令通りに処理する。
- 結果の書き込み：実行結果をメモリに書き込む。
<br />

### CPUの構成要素
CPUはさまざまな気候で構成されている。中でも重要なのは、レジスタ・ALU・デコーダ。<br>
- レジスタ：メモリから取得した命令やデータ、計算結果を格納する入れ物（変数）のような役割がある。一旦レジスタに格納してから演算を行い、結果をまたレジスタに格納する。
- ALU：四則演算や論理演算を行う機構。指定されたレジスタの値を利用して計算を行い、結果をアキュムレータ（計算結果を保持するレジスタ）に格納する。
- デコーダ：命令レジスタが保持している命令を解読し、CPU内部のどの部分を動作させるのかを決める機構。
<br />
<br />

### CPUの設計と高速化
- クロック周波数：CPUの各機構がタイミングを合わせて動作させるための信号をクロックと言い、そのクロックを１秒間に幾つ発生させるかをクロック周波数と呼ぶ。
- クロック周波数を高くすれば動作は速くなるが、電気回路としての物理的な制約や発熱が原因である程度以上高くすることは困難。
- CISCとRISC：CPUの構造としてCISCとRISCがある。<br>
CISCは、高機能な命令を豊富に用意したCPUだが、動作が遅くなりがち。ソフトウェア的に実現しており、マイクロプログラム制御という。<br>
RISCは、よく使う基本的な命令のみに絞ったCPUで、動作は速い。ハードウェアで実現しており、ワイヤードロジック方式という。
- パイプライン制御：昔のCPUは、1つの命令が完了するまで次の命令を実行できず処理が遅かったが、１つの命令が次の段階に進んだら次の命令を実行し、いくつかの命令を同時に処理できるようにすることで高速化を実現したこと。
- ハザード：パイプライン制御を阻害する様々な要因のこと。代表的なのは、条件分岐命令・ジャンプ命令の実行(制御ハザードと呼ぶ)、直前の命令の実行結果を利用する（データハザードと呼ぶ）の２つ。
- マルチコアプロセッサ：CPU本体の回路をコアと呼び、1つのCPUパッケージの中に複数のコアが入っているCPUをマルチコアプロセッサと呼ぶ。2つのコアはデュアル、4つのコアはクアッド。消費電力を抑えながら、プロセッサ全体の処理性能を高められる。
<br />
<br />

### 機械語命令とアドレッシングモード
- 機械語(アセンブリ言語)：CPUが直接理解できる唯一の言語。プログラミング言語は、一旦機械語に翻訳されてから実行されている。
- 機械語命令の構成：命令部とオペランド部から構成されており、命令部には実行する命令の名称、オペランド部には、処理対象のデータを指定する。
- アドレッシングモード：オペランド部では、処理対象のデータが格納されている場所（何番地にあるか）を指定しており、その指定方法をアドレッシングモード（アドレス修飾）と呼ぶ。
- アドレッシングモードの種類：<br>
・直接アドレス指定：オペランド部記載の番地をそのまま解釈。絶対アドレス指定とも呼ぶ。<br>
・間接アドレス指定：オペランド部記載の番地に書いてある有効アドレスを参照する。つまり、2回メモリアクセスをするため間接アドレス指定と呼ぶ。<br>
・インデックスアドレス指定：オペランド部記載の番地に、添字を追加することで、主に配列にアクセスする。<br>
・ベースアドレス指定：オペランド部記載の番地に、ベースレジスタの値を足した値を有効アドレスとする指定方法。<br>
・相対アドレス指定：オペランド部記載の値を実行中の命令（プログラムカウンタ（PCレジスタ）に格納されている番地）とデータの格納場所との変位であると解釈する方法。PCレジスタ＋オペランドが有効アドレスになる。<br>
・即値アドレス指定：オペランド部記載の値がそのまま処理対象であるデータ。命令を取得するだけでデータも一緒に種t区できるので、新たにオペランドを得るためのメモリアクセスを必要としない。

### メモリ
- ROM・RAMという2種類がある。<br>
ROMは、Read Only Memoryの略で、読み出し専用メモリの意味だが書き込みもできる。アクセス速度はRAMに比べて遅いが、不揮発性がある。消えては困るデータを保存するために使うので、コンピューターの基本設定の記録や、外部記憶装置などに用いられている。<br>
RAMは、アクセス速度はROMより速いが、不揮発性はない。コンピューターの主記憶として利用される。DRAM・SRAMがある。<br>
DRAMはSRAMに比べて低速だが大容量。定期的なリフレッシュ（コンデンサへの再充電）が必要。主記憶に用いられる。<br>
SRAMはDRAMに比べて高速だが小容量。リフレッシュは必要なし。キャッシュメモリに用いられる。<br>
<br />

- 誤り制御
メモリに記録したデータは、外界からの電気ノイズなどが原因で、内容が変化してしまうことがある。この時、エラーを発見したり訂正したりする技術が誤り制御。<br>
・パリティ：1ビットの誤りを発見する技術。訂正まではできない。<br>
・ハミング符号：1ビットの誤りを発見し、訂正までできる。また2ビットの誤りを発見だけできる。
<br />

- 高速アクセス
・キャッシュメモリ：SRAMを用いた高速なメモリ。CPU内部に存在し、頻繁にアクセスするデータの部分コピーを保存しておく。<br>
こうすることで、CPUはまずキャッシュメモリを参照し、該当データがあれば、そこから取得するだけで済むので高速化できる。（CPU外部である主記憶からデータ取得するのに比べて速い。）<br>
該当データがなければ、主記憶からデータを入手すると同時に、このキャッシュメモリにコピーを保存する。データが満杯の時は、最も不要と思われるデータを削除して置き換える。
ちなみに、必要とするデータが存在している確率を「ヒット率」という。
<br />

- 実行メモリアクセス時間
・キャッシュメモリを導入した場合の、メモリへの実質的なアクセス時間のこと。次の式で求められる。<br>

　ヒット率　*　キャッシュメモリのアクセス時間　+　(1 - ヒット率)　*　(主記憶のアクセス時間)
<br />
<br />

- ライトスルーとライトバック<br>
・ライトスルー：キャッシュメモリと主記憶の両方に書き込む方式。<br>
・ライトバック：一旦キャッシュメモリだけに書き込んで、追い出される時に主記憶に反映させる方式。
<br />

- メモリインタリーブ
主記憶へのアクセス時間を短縮する仕組み。<br>
主記憶をバンク（区画）に分けて、各バンクに並列（交互）にアクセスすることでアクセス時間を短縮する。
<br />
<br />

### ハードディスク装置
磁気を利用してデータを記録する装置。低価格で大容量だが、データのアクセスに時間がかかる。メモリのアクセス時間と比べると約100万倍遅いらしい。<br>
<br />

- 記録方法
データを記録するディスクと、データを記録するためのヘッドで構成される。<br>
記録する際には、ディスクを同心円上に区切ってトラックを設けて、さらに一定サイズで区切ってセクタを設ける。データは、そのセクタを単位として記録される。<br>
1つのセクタの容量を全て使い切らない場合でも、1セクタ丸ごとを消費する。
<br />

- データのアクセス時間
ヘッドを目的のトラックへ移動させることを、シークという。<br>
ディスクが回転して、ヘッドの真下にデータが到着するまでを、回転待ち（サーチ）という。<br>
ヘッドの下をデータが通過すると読み取れる。<br>
上記から、アクセス時間は次のように求められる。<br>

　アクセス時間 = 平均シーク時間 + 平均回転待ち時間 + データ転送時間
<br>
平均回転待ち時間は、ディスクが1/2回転する時間。<br>
平均転送時間は、読み込むデータサイズ/1トラックのサイズ * ディスクが1回転する時間
<br />
<br />

- フラグメンテーションとデフラグメンテーション
ハードディスク装置上のデータに対して書き込みや更新を繰り返すと、1つの連続したデータが細切れになってトラック上にバラバラに記録されるようになる。この状態をフラグメンテーションという。<br>
この場合、1つのデータを読み込むのに何度もシークしなければいけなくなり、時間がかかってしまう。<br>
これを解消するのがデフラグメンテーションで、細切れになったデータを1箇所に連続して配置し直す。
<br />



